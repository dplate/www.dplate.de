<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-menu/paper-submenu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="my-menu">
  <template>
    <style>
      a {
        text-decoration: none;
        color: black;
        width: 100%;
        line-height: 48px;
        padding-left: 16px;
      }
      paper-item {
        --paper-item: {
          padding: 0;
        }
      }
      .menu-content a {
        padding-left: 32px;
      }
    </style>
    <iron-ajax auto url="menuitems.json" handle-as="json" last-response="{{items}}"></iron-ajax>
    <paper-menu selected="{{path}}" attr-for-selected="name">
      <template is="dom-repeat" items="[[items]]">
        <template is="dom-if" if="[[item.subs]]">
          <paper-submenu id="[[item.name]]" opened="[[_isSubMenuOpen(item.name)]]">
            <paper-item class="menu-trigger">
              <a href="/[[item.name]]/[[_nameOfFirstSubItem(item.subs.*)]]">[[item.label]]</a>
            </paper-item>
            <paper-menu selected="{{path}}" attr-for-selected="name" class="menu-content">
              <template is="dom-repeat" items="[[item.subs]]" as="subItem">
                <paper-item name="/[[item.name]]/[[subItem.name]]">
                  <a href="/[[item.name]]/[[subItem.name]]">[[subItem.label]]</a>
                </paper-item>
              </template>
            </paper-menu>
          </paper-submenu>
        </template>
        <template is="dom-if" if="[[!item.subs]]">
          <paper-item name="/[[item.name]]">
            <a href="/[[item.name]]">[[item.label]]</a>
          </paper-item>
        </template>
      </template>
    </paper-menu>
  </template>

  <script>
    Polymer({
      is: 'my-menu',

      properties: {
        path: {
          type: String
        }
      },

      _isSubMenuOpen: function(subMenuName) {
        if (this.path) {
          var matchSubMenu = /\/(.*)\/.*/;
          var match = this.path.match(matchSubMenu);
          if (match) {
            return match[1] == subMenuName;
          }
        }
      },

      _nameOfFirstSubItem: function(change) {
        return change.base[0].name;
      }
    });
  </script>
</dom-module>