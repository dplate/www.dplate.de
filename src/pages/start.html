<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="styles.html">

<dom-module id="my-page-start">
  <template>
    <style include="page-styles"></style>

    <div class="card">
      <h1>Herzlich willkommen</h1>
      <p>Hier finden Du ein wildes Sammelsurium von allem, was ich für veröffentlichbar halte.</p>
    </div><br />

    <div class="card">
      <h2>Alpinfunk</h2>
      <p>Diverse Ski- oder Wanderberichte von meinen Ausflügen in die Alpen.</p>
      <p>
        Neueste Berichte:<br />
        <template is="dom-repeat" items="[[latestAlpineItems]]">
          <a href="/[[_namesToPath(item.names.*)]]">[[item.label]] - [[item.subLabel]]</a><br />
        </template>
      </p>
    </div>

    <div class="card">
      <h2>Fotolabor</h2>
      <p>Eine Auswahl meiner besten Fotos.</p>
      <a href="/photos">Anschauen</a><br />
    </div>

    <div class="card">
      <h2>Spielzimmer</h2>
      <p>Downloads von mir entwickelter PC-Spiele.</p>
      <template is="dom-repeat" items="[[latestGamesItems]]">
        <a href="/[[_namesToPath(item.names.*)]]">[[item.label]]</a><br />
      </template>
    </div>

    <div class="card">
      <h2>Werkzeugschuppen</h2>
      <p>Downloads von mir entwickelter PC-Tools.</p>
      <template is="dom-repeat" items="[[latestToolsItems]]">
        <a href="/[[_namesToPath(item.names.*)]]">[[item.label]]</a><br />
      </template>
    </div>
  </template>

  <script>
    Polymer({
      is: 'my-page-start',

      properties: {
        items: {
          type: Array,
          observer: '_itemsChanged'
        }
      },

      _itemsChanged: function(items) {
        this.latestAlpineItems = this._findLatestItems(this._findItem(items, 'alpine'));
        this.latestGamesItems = this._findLatestItems(this._findItem(items, 'games'));
        this.latestToolsItems = this._findLatestItems(this._findItem(items, 'tools'));
      },

      _findItem: function(items, name) {
        return items.find(function(item) { return item.name == name; })
      },

      _findLatestItems: function(item) {
        if (!item.subs) {
          return [{
            label: item.label,
            subLabel: item.subLabel,
            names: [ item.name ]
          }];
        } else {
          var items = item.subs.map(this._findLatestItems.bind(this));
          var latestItems = items.reduce(function(reducedItems, subItems) {
            var combinedItems = reducedItems.concat(subItems);
            var sortedItems = combinedItems.sort(function(item1, item2) {
              return (item1.names[item1.names.length - 1] > item2.names[item2.names.length - 1] ? -1 : 1);
            });
            return sortedItems.slice(0, 5);
          }, []);
          return latestItems.map(function(latestItem) {
            return {
              label: latestItem.label,
              subLabel: latestItem.subLabel,
              names: [ item.name ].concat(latestItem.names)
            }
          });
        }
      },

      _namesToPath: function(change) {
        return change.base.join('/');
      }
    });
  </script>
</dom-module>
